<p align="center">
  <a href="http://nestjs.com/" target="blank"><img src="https://nestjs.com/img/logo-small.svg" width="200" alt="Nest Logo" /></a>
</p>

<p align="center">
  <b>NestJS File Upload System</b> - A robust file upload system with chunking functionality
</p>

## Description

A robust file upload system built with NestJS that supports both single file uploads and large file uploads with chunking functionality.

## Features

- **Single File Upload**: Direct upload of small files to the server
- **Large File Upload with Chunking**: Split large files into smaller chunks for efficient uploading
- **Client-side Chunk Management**: JavaScript implementation for splitting files into chunks
- **Server-side Chunk Storage**: Store chunks in dedicated folders based on upload ID
- **Chunk Merging**: Combine uploaded chunks into a complete file
- **Progress Tracking**: Real-time upload progress visualization
- **Conflict Prevention**: Unique upload IDs to prevent naming conflicts
- **Folder Cleanup**: Automatic cleanup after successful merging

## Technology Stack

- **Backend**: NestJS (Node.js framework)
- **File Handling**: Multer for file uploads
- **Frontend**: HTML, CSS, JavaScript
- **HTTP Client**: Axios for making API requests

## Installation

```bash
# Install dependencies
$ npm install
```

## Running the Application

```bash
# Development mode
$ npm run start:dev

# Production mode
$ npm run start:prod
```

## API Endpoints

### Single File Upload

```
POST /upload/file
```

Uploads a single file directly to the server. Suitable for small files.

### Large File Upload (Chunking)

```
POST /upload/large-files
```

Uploads a chunk of a large file. Requires the following parameters:

- `file`: The chunk data
- `name_file`: Original file name
- `chunk_index`: Index of the current chunk
- `total_chunks`: Total number of chunks
- `upload_id`: Unique identifier for the upload (generated by client)

### Merge Chunks

```
POST /upload/large-files/merge
```

Merges all uploaded chunks into a complete file. Requires:

- `upload_id`: The unique identifier for the upload

## Client Implementation

The project includes two HTML examples demonstrating how to use the API:

1. `html/index.html`: Basic implementation with progress tracking
2. `html/test-upload.html`: More advanced implementation with separate sections for single and chunked uploads

### Chunking Process

1. Client generates a unique `upload_id` using timestamp and filename
2. File is split into chunks of configurable size (default: 100KB)
3. Each chunk is uploaded with metadata (chunk index, total chunks, etc.)
4. Server stores chunks in a folder named with the `upload_id`
5. After all chunks are uploaded, client can request merging
6. Server combines chunks into a complete file and cleans up the chunk folder

## Configuration

Key configuration options can be found in:

- `src/oss.ts`: Storage configuration and file naming
- `src/app.controller.ts`: API endpoints and Multer options
- `src/file-upload.service.ts`: Chunk handling and merging logic

Default chunk size is set to 100KB in the client implementation, but can be adjusted based on your needs.

## File Size Limits

- Single file upload: 20MB (configurable)
- Chunked upload: 1000MB total (configurable)
- Maximum number of files: 100 (configurable)

## Error Handling

The system includes comprehensive error handling for:

- Missing files
- Invalid upload IDs
- Missing chunks
- File type validation (configurable)

## Security Considerations

- File type validation to prevent uploading of malicious files
- Size limits to prevent denial of service attacks
- Unique folder names to prevent overwriting existing files

## License

This project is licensed under the UNLICENSED license.
